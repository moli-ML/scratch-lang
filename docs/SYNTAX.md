# ScratchLang 语法参考手册

## 目录

1. [基本结构](#基本结构)
2. [事件积木](#事件积木)
3. [动作积木](#动作积木)
4. [外观积木](#外观积木)
5. [声音积木](#声音积木)
6. [控制积木](#控制积木)
7. [侦测积木](#侦测积木)
8. [运算积木](#运算积木)
9. [变量积木](#变量积木)
10. [画笔积木](#画笔积木)
11. [音乐扩展](#音乐扩展)
12. [扩展导入](#扩展导入)
13. [自定义积木](#自定义积木)
14. [资源管理](#资源管理)

---

## 基本结构

### 项目开始标记
```
: 开始
```

### 舞台声明
```
@ 舞台
```

### 角色声明
```
# 角色名
```

### 注释
```
// 这是单行注释

/* 这是
   块注释
   可以跨多行 */
```

---

## 事件积木

### 当绿旗被点击
```
当绿旗被点击
  // 代码块
```

### 当按下键
```
当按下 空格 键
当按下 上 键
当按下 a 键
```

支持的按键：
- `空格` / `空格键`
- `上` / `上箭头`
- `下` / `下箭头`
- `左` / `左箭头`
- `右` / `右箭头`
- `回车`
- `任意`
- 单个字母或数字

### 当角色被点击
```
当角色被点击
```

### 当舞台被点击
```
当舞台被点击
```

### 当收到广播
```
当收到 消息名
```

### 当背景换成
```
当背景换成 背景名
```

---

## 动作积木

### 移动
```
移动 10 步
移动 ~速度 步    // 使用变量
```

### 旋转
```
旋转右 90 度
旋转左 45 度
```

### 移到坐标
```
移到 100 200
移到 ~x坐标 ~y坐标
```

### 移到目标
```
移到 鼠标指针
移到 随机位置
移到 角色名
```

### 面向
```
面向 90 方向
面向 鼠标指针
面向 角色名
```

### 滑行
```
在 1 秒内滑行到 100 200
在 2 秒内滑行到 鼠标指针
```

### 坐标操作
```
将x坐标增加 10
将x坐标设为 0
将y坐标增加 -10
将y坐标设为 100
```

### 碰到边缘反弹
```
碰到边缘就反弹
```

### 旋转方式
```
将旋转方式设为 左右翻转
将旋转方式设为 不可旋转
将旋转方式设为 任意旋转
```

---

## 外观积木

### 说和想
```
说 "你好！"
说 "你好！" 2秒
想 "嗯..."
想 "嗯..." 3秒
```

### 转义字符
在字符串中支持以下转义字符：
```
说 "第一行\n第二行"    // 换行
说 "制表符\t分隔"      // Tab
说 "引号: \"你好\""    // 双引号
说 "反斜杠: \\"        // 反斜杠
```

### 多行字符串
使用三引号 `"""` 定义多行字符串：
```
说 """这是一段
很长的
多行文本"""
```

### 造型
```
切换造型到 造型名
下一个造型
```

### 背景
```
切换背景到 背景名
下一个背景
```

### 大小
```
将大小设为 100
将大小增加 10
```

### 显示/隐藏
```
显示
隐藏
```

### 图层
```
移至最前层
移至最后层
图层增加 1
图层减少 1
```

### 特效
```
将 颜色 特效增加 25
将 颜色 特效设为 0
清除图形特效
```

---

## 声音积木

### 播放声音
```
播放声音 声音名
播放声音 声音名 并等待
```

### 停止声音
```
停止所有声音
```

### 音量
```
将音量设为 100
将音量增加 -10
```

### 音调
```
将音调设为 100
```

### 清除特效
```
清除声音特效
```

---

## 控制积木

### 等待
```
等待 1 秒
等待 ~时间 秒
```

### 重复
```
重复 10 次
  移动 10 步
  旋转右 36 度
结束
```

### 重复执行
```
重复执行
  移动 5 步
  碰到边缘就反弹
结束
```

### 如果
```
如果 ~分数 > 10 那么
  说 "你赢了！"
结束
```

### 如果否则
```
如果 ~分数 > 10 那么
  说 "你赢了！"
否则
  说 "继续加油！"
结束
```

### 等待直到
```
等待直到 碰到 边缘
```

### 重复执行直到
```
重复执行直到 ~分数 > 100
  移动 10 步
结束
```

### 停止
```
停止 全部
停止 此脚本
停止 此角色的其他脚本
```

### 克隆
```
克隆 自己
克隆 角色名
```

### 当作为克隆体启动
```
当作为克隆体启动
  // 克隆体代码
```

### 删除克隆体
```
删除此克隆体
```

### 广播
```
广播 消息名
广播 消息名 并等待
```

---

## 侦测积木

### 询问
```
询问 "你叫什么名字？" 并等待
```

### 计时器
```
计时器归零
```

### 拖动模式
```
设置拖动模式为 可拖动
设置拖动模式为 不可拖动
```

---

## 运算积木

### 四舍五入
```
四舍五入 3.7
```

### 数学运算
```
abs -5
sqrt 16
sin 90
cos 0
```

### 字符串操作
```
第 1 个字符是 "hello"
字符串长度 "hello"
```

---

## 变量积木

### 声明变量
```
变量: 分数 = 0
变量: 名字 = "玩家"
变量: 速度
```

### 设置变量
```
设置 分数 为 100
设置 名字 为 "新名字"
```

### 变量增加
```
将 分数 增加 10
将 速度 增加 -1
```

### 显示/隐藏变量
```
显示变量 分数
隐藏变量 分数
```

### 引用变量
使用 `~` 前缀引用变量：
```
移动 ~速度 步
说 ~名字
如果 ~分数 > 10 那么
```

### 云变量
云变量会在所有用户之间同步（需要 Scratch 账号）：
```
云变量: 高分 = 0
云变量: 在线人数
```

云变量只能存储数字，引用时使用 `~☁ 变量名`。

### 列表操作
```
列表: 数据

添加 "项目" 到 数据
删除 数据 的第 1 项
清空 数据
插入 "新项目" 到 数据 的第 1 项
替换 数据 的第 1 项为 "替换内容"
```

---

## 画笔积木

### 基本操作
```
清空
图章
落笔
抬笔
```

### 笔迹设置
```
将笔的颜色设为 #FF0000
将笔的粗细设为 5
将笔的粗细增加 1
将笔的 颜色 增加 10
将笔的 亮度 增加 10
```

---

## 音乐扩展

### 演奏音符
```
演奏音符 60 0.5 拍    // 音符60，持续0.5拍
演奏音符 72 1 拍
```

### 演奏鼓声
```
演奏鼓声 1 0.25 拍    // 鼓声1，持续0.25拍
```

### 休止
```
休止 1 拍
休止 0.5 拍
```

### 乐器和节奏
```
将乐器设为 1          // 1=钢琴, 2=电子琴...
将节奏设为 120        // BPM
将节奏增加 10
```

---

## 扩展导入

### 导入自定义扩展
可以导入外部 Scratch 扩展 JavaScript 文件：

```
导入扩展: "myextension.js"
导入扩展: "extensions/custom.js"

// 英文语法
import extension: "myextension.js"
```

**说明：**
- 扩展文件必须是标准的 Scratch 3.0 扩展格式
- 编译器会自动从 JS 文件中提取扩展 ID
- 扩展 ID 会添加到生成的 .sb3 项目中
- 在 Scratch 中加载项目时需要确保扩展可用

**扩展 JS 文件示例：**
```javascript
class MyExtension {
    getInfo() {
        return {
            id: 'myextension',
            name: '我的扩展',
            blocks: [...]
        };
    }
}
```

### 内联 JavaScript 代码
可以直接在代码中嵌入 JavaScript（TurboWarp 兼容）：

```
#code#
console.log('Hello from ScratchLang!');
// 这里可以写任意 JavaScript 代码
#end#
```

**说明：**
- JS 代码会保存在项目的 `extensionURLs` 字段中
- 使用 data URL 格式（与 TurboWarp 完全兼容）
- 每个 #code# 块会生成一个扩展 ID（inlinecode1, inlinecode2...）
- 在 TurboWarp 中打开项目时，JS 代码会自动加载并执行
- `console.log()` 输出会显示在浏览器控制台
- 标准 Scratch 不支持此功能，需要使用 TurboWarp

**项目格式：**
```json
{
  "extensions": ["inlinecode1"],
  "extensionURLs": {
    "inlinecode1": "data:application/javascript,console.log%28%27test%27%29%3B"
  }
}
```

**示例：**
```
#code#
console.log('项目启动');
window.myCustomFunction = function() {
    console.log('自定义函数');
};
#end#

# 角色1
当绿旗被点击
    说 "查看控制台" 2 秒
结束
```

---

## 自定义积木

### 定义自定义积木
```
定义 积木名()
    // 积木内容
结束

定义 移动并说话(步数, 内容)
    移动 ~步数 步
    说 ~内容
结束
```

### 不刷新屏幕模式
用于需要快速执行的计算：
```
定义 快速计算(次数) 不刷新屏幕
    重复 ~次数 次
        将 计数 增加 1
    结束
结束
```

### 调用自定义积木
```
积木名
移动并说话 10 "你好"
快速计算 1000
```

---

## 资源管理

### 添加造型
```
造型: images/cat.png
造型: sprites/dog.svg
```

### 添加背景
```
背景: backgrounds/sky.png
背景: bg/forest.jpg
```

### 添加音效
```
音效: sounds/meow.mp3
音效: audio/bark.wav
```

---

## 条件表达式

### 比较运算符
```
~变量 > 10
~变量 < 5
~变量 = 0
~变量 >= 10    // 大于等于
~变量 <= 5     // 小于等于
```

### 逻辑运算符
```
~变量 > 0 且 ~变量 < 100
~变量 = 0 或 ~变量 = 100
```

### 侦测条件
```
碰到 边缘
碰到 鼠标指针
碰到 角色名
按下 空格 键
鼠标按下
```

---

## 内置 Reporter

使用 `~` 前缀访问内置值：

```
~x坐标          // 当前 x 坐标
~y坐标          // 当前 y 坐标
~方向           // 当前方向
~大小           // 当前大小
~音量           // 当前音量
~计时器         // 计时器值
~回答           // 询问的回答
~鼠标x坐标      // 鼠标 x 坐标
~鼠标y坐标      // 鼠标 y 坐标
~造型编号       // 当前造型编号
~造型名称       // 当前造型名称
~背景编号       // 当前背景编号
~背景名称       // 当前背景名称
```

### 获取其他角色属性
```
~小猫的x坐标
~小狗的方向
~舞台的背景编号
```

---

## 完整示例

```
: 开始

@ 舞台
背景: images/sky.png

当绿旗被点击
  切换背景到 sky

# 小猫
变量: 分数 = 0
变量: 速度 = 5
造型: images/cat.png

当绿旗被点击
  移到 0 0
  将大小设为 100
  设置 分数 为 0
  说 "欢迎！按方向键移动" 2秒

当按下 上 键
  将y坐标增加 ~速度

当按下 下 键
  将y坐标增加 -5

当按下 左 键
  将x坐标增加 -5

当按下 右 键
  将x坐标增加 ~速度

当按下 空格 键
  将 分数 增加 1
  说 ~分数 0.5秒

# 敌人
当绿旗被点击
  移到 100 100
  重复执行
    移动 3 步
    碰到边缘就反弹
  结束
```

---

*ScratchLang v2.0 - 语法参考手册*
